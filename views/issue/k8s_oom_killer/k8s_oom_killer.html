<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一次k8s容器内存oom-kill问题研究 | 一水轩</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="https://cdn.jsdmirror.com/gh/kkyeer/picbed/favicon_coder.ico">
    <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css">
    <meta name="description" content="Born for code">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/css/0.styles.f6d07da3.css" as="style"><link rel="preload" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/app.fd5d37e3.js" as="script"><link rel="preload" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/4.9ffcf601.js" as="script"><link rel="preload" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/1.0a35a5ae.js" as="script"><link rel="preload" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/36.305c8fcc.js" as="script"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/10.eae1b8d8.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/100.7f911c78.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/101.2b28781d.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/102.cd4396b5.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/103.d826eac6.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/104.d69be96f.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/105.37aacc7b.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/106.b01f92b2.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/107.364f1213.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/108.d658603c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/109.b27d2501.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/11.99b3f9b6.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/110.cdfac142.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/111.48d8e7f3.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/112.c189a792.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/113.55aeb7f6.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/114.b525f32e.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/115.ae1dda46.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/116.0075635e.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/117.e9026db2.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/118.433115ee.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/119.af97a06d.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/12.24168af0.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/120.9aa3cd9e.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/121.7dfcdc80.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/122.fd067c2c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/123.28c3705d.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/124.4f7a39dd.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/125.86ecaf66.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/126.b813d167.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/127.b2c9b079.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/128.19cebc65.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/129.9291f840.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/13.52fedd07.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/130.11dfe145.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/131.5257a91a.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/132.18ace014.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/133.545c3f21.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/134.385986cd.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/135.729f9dca.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/136.5052f535.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/137.2d7aa242.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/138.a02ded40.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/139.22bacd7e.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/14.d90d739d.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/140.ef14f42a.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/141.09ad57fe.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/142.be0a034c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/143.6e2f6c37.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/144.9b2463e3.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/145.e18ec0a3.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/15.001af068.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/16.0a65167b.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/17.0355a96b.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/18.5ae6bd4b.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/19.ee27d6ec.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/20.80de067e.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/21.a7da6c4c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/22.685794f7.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/23.85e7910d.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/24.ecbce7d1.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/25.f5807ea2.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/26.6810a4f5.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/27.a15cc2bd.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/28.4a003a6d.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/29.2dac63d2.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/30.cd65b859.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/31.5a7ecacb.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/32.2713aac1.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/33.91765296.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/34.a54874b4.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/35.275be613.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/37.9e87627a.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/38.c14dd1ef.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/39.3918c517.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/40.e064f1b0.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/41.05304bcd.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/42.3794a093.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/43.0fab4a02.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/44.45a4c81f.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/45.4e7456d7.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/46.e0dc76dd.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/47.5045b917.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/48.e276cfa8.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/49.97e6e57c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/5.64ac0c73.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/50.28c41cee.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/51.4b9004c8.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/52.7d8bd4ac.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/53.f692ba60.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/54.ffcdc22f.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/55.b9709469.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/56.fd1eb899.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/57.6d2e8ab0.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/58.1d97188c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/59.e7d91185.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/6.7893646e.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/60.ecb07fcb.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/61.dd573cf7.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/62.38d6c00f.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/63.5ccca3e4.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/64.86fdeb79.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/65.c11339f0.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/66.8ec00d45.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/67.b525e27b.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/68.90e92cf5.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/69.baa74a11.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/7.89b04021.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/70.7e346cde.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/71.a9dbb524.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/72.79991f0c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/73.8b112e7f.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/74.fd0a7398.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/75.89eabcd8.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/76.07dbdae0.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/77.85cb4e56.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/78.e52ed308.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/79.f98a101c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/8.716399f1.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/80.e4040c9b.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/81.e19282c5.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/82.35edd744.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/83.642983dd.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/84.6adc5118.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/85.6747f02c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/86.18213787.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/87.3756d638.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/88.25b645b4.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/89.d7f6e75c.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/9.2f99b81f.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/90.0aaceed7.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/91.30f58125.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/92.5a719cce.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/93.6f5c5dd7.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/94.28d2e287.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/95.c1fce8de.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/96.996d6471.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/97.a5d8d4f6.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/98.4a4ce574.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/99.e6b313a6.js"><link rel="prefetch" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/vendors~flowchart.7dc40914.js">
    <link rel="stylesheet" href="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/css/0.styles.f6d07da3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>一水轩</h3> <p class="description" data-v-59e6cb88>Born for code</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>kkyeer</span>
          
        <span data-v-59e6cb88>2019 - </span>
        2025
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.jsdmirror.com/gh/kkyeer/picbed/avatar_coder.png" alt="一水轩" class="logo"> <span class="site-name">一水轩</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>服务端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/JDK源码/" class="nav-link"><i class="undefined"></i>
  JDK源码
</a></li><li class="dropdown-subitem"><a href="/categories/JVM/" class="nav-link"><i class="undefined"></i>
  JVM
</a></li><li class="dropdown-subitem"><a href="/categories/Java进阶/" class="nav-link"><i class="undefined"></i>
  Java进阶
</a></li><li class="dropdown-subitem"><a href="/categories/设计模式/" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-subitem"><a href="/categories/Dubbo/" class="nav-link"><i class="undefined"></i>
  Dubbo
</a></li><li class="dropdown-subitem"><a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/JS/" class="nav-link"><i class="undefined"></i>
  JS
</a></li><li class="dropdown-subitem"><a href="/categories/前端DevOps/" class="nav-link"><i class="undefined"></i>
  前端DevOps
</a></li></ul></li><li class="dropdown-item"><h4>问题解决</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/线上问题/" class="nav-link"><i class="undefined"></i>
  线上问题
</a></li><li class="dropdown-subitem"><a href="/categories/开发问题/" class="nav-link"><i class="undefined"></i>
  开发问题
</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/懂/" class="nav-link"><i class="undefined"></i>
  懂
</a></li><li class="dropdown-subitem"><a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kkyeer" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/d42f2ae217ce" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="https://cdn.jsdmirror.com/gh/kkyeer/picbed/avatar_coder.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    kkyeer
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>104</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>85</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>服务端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/JDK源码/" class="nav-link"><i class="undefined"></i>
  JDK源码
</a></li><li class="dropdown-subitem"><a href="/categories/JVM/" class="nav-link"><i class="undefined"></i>
  JVM
</a></li><li class="dropdown-subitem"><a href="/categories/Java进阶/" class="nav-link"><i class="undefined"></i>
  Java进阶
</a></li><li class="dropdown-subitem"><a href="/categories/设计模式/" class="nav-link"><i class="undefined"></i>
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-subitem"><a href="/categories/Dubbo/" class="nav-link"><i class="undefined"></i>
  Dubbo
</a></li><li class="dropdown-subitem"><a href="/categories/Redis/" class="nav-link"><i class="undefined"></i>
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/JS/" class="nav-link"><i class="undefined"></i>
  JS
</a></li><li class="dropdown-subitem"><a href="/categories/前端DevOps/" class="nav-link"><i class="undefined"></i>
  前端DevOps
</a></li></ul></li><li class="dropdown-item"><h4>问题解决</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/线上问题/" class="nav-link"><i class="undefined"></i>
  线上问题
</a></li><li class="dropdown-subitem"><a href="/categories/开发问题/" class="nav-link"><i class="undefined"></i>
  开发问题
</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/懂/" class="nav-link"><i class="undefined"></i>
  懂
</a></li><li class="dropdown-subitem"><a href="/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/kkyeer" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/d42f2ae217ce" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>kkyeer</span>
          
        <span data-v-59e6cb88>2019 - </span>
        2025
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">一次k8s容器内存oom-kill问题研究</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>kkyeer</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>6/9/2025</span></i> <i class="iconfont reco-eye" data-v-8a445198><span id="/views/issue/k8s_oom_killer/k8s_oom_killer.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-8a445198><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>k8s</span><span class="tag-item" data-v-8a445198>内存</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="一次k8s容器内存oom-kill问题研究"><a href="#一次k8s容器内存oom-kill问题研究" class="header-anchor">#</a> 一次k8s容器内存oom-kill问题研究</h1> <h2 id="问题现象"><a href="#问题现象" class="header-anchor">#</a> 问题现象</h2> <p>公司最近逐步推进JRE8升级到JRE17，在解决了升级初期的一些库升级、兼容问题后，大部分应用容器趋于稳定。
随着升级的服务越来越多，最近发现部分升级JRE17服务的容器有零星的注册中心健康检查失败报错，涉及到多个服务的多个节点，虽然在<strong>报错一次后恢复正常</strong>，但是这个现象是以前这些服务从来没有出现过的，基于不放过任何一个疑点的原则，有必要调查一下原因。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">2025</span>-05-28 <span class="token number">10</span>:01:28.330
标题:断开连接<span class="token punctuation">(</span>异常<span class="token punctuation">)</span>
应用:xxx <span class="token punctuation">(</span>default:-1<span class="token punctuation">)</span>
实例:10.100.1.1:8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="初步定位"><a href="#初步定位" class="header-anchor">#</a> 初步定位</h2> <ol><li>最初的报错是注册中心发出，查看注册中心的事件日志确认，报错是因为注册中心调用容器的<code>/actuator/health</code>接口时，http连接异常断开</li> <li>一般来说，http连接异常断开有几种可能
<ul><li>网络异常：丢包，延迟，阻塞</li> <li>调用方超时主动断开：连接超时、读超时</li> <li>被调用方响应性能异常：建连失败、响应超时、tcp reset</li></ul></li> <li>排查异常容器的核心指标，主要是worker线程数量，内网指标tcp丢包率等，排除了上述常见可能性后，再查看容器的事件日志，发现问题容器都有被k8s重启的相关事件，且时间点与注册中心异常告警一致，初步认定<strong>容器被k8s重启是导致注册中心告警的原因</strong></li> <li>排查k8s日志，发现对应时间点，容器进程内存占用超过了k8s配置文件对requests.limit的限制，最终导致k8s强制关闭容器</li> <li>排查容器内存指标，能看到容器的物理内存在30%~40%左右，但是容器内存持续保持在100%接近1分钟</li></ol> <p><img src="https://cdn.jsdmirror.com/gh/kkyeer/picbed/memUsage_aom_combined.svg" alt="memUsage_aom_combined"> <img src="https://cdn.jsdmirror.com/gh/kkyeer/picbed/memUsed_aom_combined.svg" alt="memUsed_aom_combined"></p> <p>经过上述的快速排查，引入了几个问题</p> <p>问题1: 物理内存和容器内存为什么差距这么大？
问题2: 容器内存具体是什么在占用？</p> <p>解决上述问题需要了解进程的内存统计以及CGroup的内存统计，有必要进行一定的知识补全</p> <h2 id="内存统计知识"><a href="#内存统计知识" class="header-anchor">#</a> 内存统计知识</h2> <ul><li><a href="https://help.aliyun.com/zh/arms/application-monitoring/developer-reference/memory-metrics" target="_blank" rel="noopener noreferrer">参考资料:常用的内存查询命令/指标的含义是什么_应用实时监控服务(ARMS)-阿里云帮助中心<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/36a1df62cda7" target="_blank" rel="noopener noreferrer">容器内存监控，是看rss还是wss?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://qingwave.github.io/container-memory/" target="_blank" rel="noopener noreferrer">参考资料：容器内存分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="linux系统内存分布"><a href="#linux系统内存分布" class="header-anchor">#</a> Linux系统内存分布</h3> <p>Linux系统内存，除系统启动过程中消耗的内存外，剩余内存为系统使用内存，一般使用free命令来查看系统整体的内存占用</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">free</span> <span class="token parameter variable">-mh</span>                                                                                                                                                
               total        used        <span class="token function">free</span>      shared  buff/cache    available                                                                    
Mem:            31Gi        15Gi       235Mi       194Mi        15Gi        15Gi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://cdn.jsdmirror.com/gh/kkyeer/picbed/linux_memory2.svg" alt="linux_memory2"></p> <ol><li>total：系统物理内存，在启动时会被启动过程，kdump等组件用掉一部分，剩下的是内核和应用程序可以使用的内存，也是free命令中输出的total字段，比物理内存略小一些</li> <li>free：完全未分配的内存</li> <li>buff/cache：由系统管理的缓存</li> <li>used：total - free - buffers - cache</li> <li>shared：Shmem共享内存页（对应共享匿名映射、tmpfs、memfd等场景），<strong>同时也会算到cache里</strong></li></ol> <p>从第2点可以推断出：total = used + buff/cache + free</p> <p>其中free很好理解，就是剩余未分配的物理内存，used是减出来的，所以关键是理解buffers和cache内存。</p> <h4 id="关于buffers-cache"><a href="#关于buffers-cache" class="header-anchor">#</a> 关于buffers/cache</h4> <p><a href="https://zhuanlan.zhihu.com/p/645904515" target="_blank" rel="noopener noreferrer">参考资料<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">man</span> <span class="token function">free</span>
<span class="token punctuation">..</span>.

buffers
      Memory used by kernel buffers <span class="token punctuation">(</span>Buffers <span class="token keyword">in</span> /proc/meminfo<span class="token punctuation">)</span>

cache  Memory used by the page cache and slabs <span class="token punctuation">(</span>Cached and SReclaimable <span class="token keyword">in</span> /proc/meminfo<span class="token punctuation">)</span>

buff/cache
      Sum of buffers and cache
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>可以看出</p> <ul><li>buffers:内核缓冲区用到的内存【Memory used by kernel buffers (Buffers in /proc/meminfo)】</li> <li>cache:PageCache和 slab【Memory used by the page cache and slabs (Cached and SReclaimable in /proc/meminfo)】</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">man</span> proc
<span class="token punctuation">..</span>.
  Buffers %lu
    Relatively temporary storage <span class="token keyword">for</span> raw disk blocks that shouldn<span class="token string">'t get tremendously large (20 MB or so).
  Cached %lu
    In-memory cache for files read from the disk (the page cache).  Doesn'</span>t include SwapCached.
  SReclaimable %lu <span class="token punctuation">(</span>since Linux <span class="token number">2.6</span>.19<span class="token punctuation">)</span>
    Part of Slab, that might be reclaimed, such as caches.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>从下面的图片可以看出，buffer位于相对底层，是文件系统和物理磁盘（块设备）之间的缓冲区，而PageCache是系统内核和文件系统之间的缓冲区。</p> <p><img src="https://cdn.jsdmirror.com/gh/kkyeer/picbed/20250612111718.png" alt="20250612111718"></p> <p>另外，linux内核使用 Slab 机制，管理文件系统的目录项和索引节点的缓存。Slab 包括两部分，其中的可回收部分，是指可以被回收的内核内存，包括目录项（dentry） 和索引节点（ inode ）的缓存等，用 SReclaimable 记录；而不可回收部分，用 SUnreclaim 记录。</p> <h5 id="系统cache-buffer回收策略"><a href="#系统cache-buffer回收策略" class="header-anchor">#</a> 系统Cache/Buffer回收策略</h5> <ol><li>系统内存不足时，会尝试异步回收cache&gt;同步回收cache，如果仍旧不足，触发oom</li> <li>可以通过写入<code>/proc/sys/vm/drop_caches</code>文件来触发系统回收，其中
<ol><li><code>echo 1 &gt; /proc/sys/vm/drop_caches</code>：释放Cache的干净页</li> <li><code>echo 2 &gt; /proc/sys/vm/drop_caches</code>：释放slab</li> <li><code>echo 1 &gt; /proc/sys/vm/drop_caches</code>：释放Cache和slab</li></ol></li> <li>如果想回收Cache的脏页，需要先执行sync，写入磁盘后变为干净页才可以回收</li></ol> <h3 id="进程内存构成"><a href="#进程内存构成" class="header-anchor">#</a> 进程内存构成</h3> <p>对于一个进程来说，与之相关联的内存可以分为2大类</p> <ol><li>基于文件的内存页，file-backed-memory:基于文件的内存页，注意，由于linux一切皆是文件的特性，这里的文件除了存储在磁盘上的文件，还包含了一些其他的特殊场景
<ol><li>基于磁盘文件的映射：比如BufferedIO</li> <li>基于MMAP读取文件：比如数据库一般会直接使用mmap来管理内存和磁盘文件的一致性，mmap方式的优点是避免了bufferedIO的</li> <li>共享匿名映射：基于/tmpfs的映射，理论上也属于mmap的一种，区别是<strong>Linux系统下/tmpfs通常对应物理内存空间而不是磁盘</strong>，常用于父子进程通信</li></ol></li> <li>匿名内存页，anno-rss：对应通过malloc方法申请的内存</li></ol> <p><img src="https://cdn.jsdmirror.com/gh/kkyeer/picbed/process_memory.svg" alt="process_memory"></p> <h3 id="常见内存统计工具"><a href="#常见内存统计工具" class="header-anchor">#</a> 常见内存统计工具</h3> <h4 id="cgroup内存统计"><a href="#cgroup内存统计" class="header-anchor">#</a> cgroup内存统计</h4> <p>可能是下面的两个路径之一:</p> <ol><li><code>/sys/fs/cgroup/memory/memory.stat</code></li> <li><code>/sys/fs/cgroup/memory.stat</code></li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">cat</span> /sys/fs/cgroup/memory/memory.stat
cache <span class="token number">2042019840</span>
rss <span class="token number">817131520</span>
<span class="token punctuation">..</span>.
mapped_file <span class="token number">545329152</span>
<span class="token punctuation">..</span>.
inactive_file <span class="token number">490184704</span>
active_file <span class="token number">949952512</span>
<span class="token punctuation">..</span>.
total_cache <span class="token number">2042019840</span>
total_rss <span class="token number">817131520</span>
<span class="token punctuation">..</span>.
total_inactive_file <span class="token number">490184704</span>
total_active_file <span class="token number">949952512</span>
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>如上，省略了部分项，剩下需要关注的</p> <ol><li>rss: 匿名内存总和</li> <li>cache: 类似free命令的cache/buffer，对应所有的file-backend内存</li> <li>mapped_file: 包含所有mmap的匿名内存(MAP_ANONYMOUS)，包含tmpfs/shmem</li> <li>active_file: 除匿名内存外的PageCache，注意cgroup统计的是此进程组使用过的所有的文件句柄对应的PageCache，包含打开和关闭（但未被回收的内存页）</li> <li>inactive_file：active_file中标记为inactive的内存页</li></ol> <p>working_set的计算公式：<strong>working_set = rss + cache - inactive_file</strong></p> <h4 id="proc-pid-status"><a href="#proc-pid-status" class="header-anchor">#</a> /proc/{pid}/status</h4> <p><code>/proc</code>文件夹下的内容是进程对应的</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">cat</span> /proc/1/status
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
VmPeak: <span class="token number">108647580</span> kB
VmSize: <span class="token number">108516356</span> kB
VmLck:         <span class="token number">0</span> kB
VmPin:         <span class="token number">0</span> kB
VmHWM:   <span class="token number">6072292</span> kB
VmRSS:   <span class="token number">1714428</span> kB
RssAnon:          <span class="token number">591256</span> kB
RssFile:           <span class="token number">18260</span> kB
RssShmem:        <span class="token number">1104912</span> kB
VmData: <span class="token number">107086612</span> kB
VmStk:       <span class="token number">152</span> kB
VmExe:         <span class="token number">4</span> kB
VmLib:     <span class="token number">22832</span> kB
VmPTE:      <span class="token number">4908</span> kB
VmSwap:        <span class="token number">0</span> kB
Threads:        <span class="token number">370</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>其中<strong>Vm</strong>前缀的内存对应虚拟内存相关指标，<strong>由于容器环境的一些限制，可能显示的是宿主机的值，仅供参考</strong>，重点关注RssAnon，RssFile和RssShmem这几个值，其中
RssAnon为匿名内存，RssFile为文件内存（不包含匿名文件映射），RssShmem为共享文件内存</p> <ul><li><p>VmSize:
虚拟内存大小。
整个进程使用虚拟内存大小，是VmLib, VmExe, VmData, 和 VmStk的总和。</p></li> <li><p>VmLck:
虚拟内存锁。
进程当前使用的并且加锁的虚拟内存总数</p></li> <li><p>VmRSS:
虚拟内存驻留集合大小。
这是驻留在物理内存的一部分。它没有交换到硬盘。它包括代码，数据和栈。
VmRSS = RssAnon + RssFile + RssShmem</p></li> <li><p>VmData:
虚拟内存数据。
堆使用的虚拟内存。</p></li> <li><p>VmStk:
虚拟内存栈
栈使用的虚拟内存</p></li> <li><p>VmExe:
可执行的虚拟内存
可执行的和静态链接库所使用的虚拟内存</p></li> <li><p>VmLib:
虚拟内存库
动态链接库所使用的虚拟内存</p></li></ul> <h4 id="proc-meminfo"><a href="#proc-meminfo" class="header-anchor">#</a> /proc/meminfo</h4> <p>可以根据文件<code>/proc/meminfo</code>的内容来查看整个系统当前的内存占用，free命令的数据也是从这个文件提取再加工的</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">cat</span> /proc/meminfo
MemTotal:       <span class="token number">32779612</span> kB
MemFree:         <span class="token number">3916296</span> kB
MemAvailable:   <span class="token number">30638252</span> kB
Buffers:          <span class="token number">855164</span> kB
Cached:         <span class="token number">24187724</span> kB
SwapCached:           <span class="token number">16</span> kB
Active:          <span class="token number">3009196</span> kB
Inactive:       <span class="token number">23054352</span> kB
Active<span class="token punctuation">(</span>anon<span class="token punctuation">)</span>:    <span class="token number">1034236</span> kB
Inactive<span class="token punctuation">(</span>anon<span class="token punctuation">)</span>:     <span class="token number">1388</span> kB
Active<span class="token punctuation">(</span>file<span class="token punctuation">)</span>:    <span class="token number">1974960</span> kB
Inactive<span class="token punctuation">(</span>file<span class="token punctuation">)</span>: <span class="token number">23052964</span> kB
Unevictable:        <span class="token number">1876</span> kB
Mlocked:               <span class="token number">0</span> kB
SwapTotal:       <span class="token number">2097148</span> kB
SwapFree:        <span class="token number">2096124</span> kB
Zswap:                 <span class="token number">0</span> kB
Zswapped:              <span class="token number">0</span> kB
Dirty:               <span class="token number">156</span> kB
Writeback:             <span class="token number">0</span> kB
AnonPages:       <span class="token number">1022560</span> kB
Mapped:           <span class="token number">587176</span> kB
Shmem:             <span class="token number">14960</span> kB
KReclaimable:    <span class="token number">2162372</span> kB
Slab:            <span class="token number">2523328</span> kB
SReclaimable:    <span class="token number">2162372</span> kB
SUnreclaim:       <span class="token number">360956</span> kB
KernelStack:       <span class="token number">13600</span> kB
PageTables:        <span class="token number">28620</span> kB
SecPageTables:         <span class="token number">0</span> kB
NFS_Unstable:          <span class="token number">0</span> kB
Bounce:                <span class="token number">0</span> kB
WritebackTmp:          <span class="token number">0</span> kB
CommitLimit:    <span class="token number">18486952</span> kB
Committed_AS:    <span class="token number">6725936</span> kB
VmallocTotal:   <span class="token number">34359738367</span> kB
VmallocUsed:      <span class="token number">106192</span> kB
VmallocChunk:          <span class="token number">0</span> kB
Percpu:            <span class="token number">15456</span> kB
HardwareCorrupted:     <span class="token number">0</span> kB
AnonHugePages:         <span class="token number">0</span> kB
ShmemHugePages:        <span class="token number">0</span> kB
ShmemPmdMapped:        <span class="token number">0</span> kB
FileHugePages:         <span class="token number">0</span> kB
FilePmdMapped:         <span class="token number">0</span> kB
Unaccepted:            <span class="token number">0</span> kB
HugePages_Total:       <span class="token number">0</span>
HugePages_Free:        <span class="token number">0</span>
HugePages_Rsvd:        <span class="token number">0</span>
HugePages_Surp:        <span class="token number">0</span>
Hugepagesize:       <span class="token number">2048</span> kB
Hugetlb:               <span class="token number">0</span> kB
DirectMap4k:      <span class="token number">604784</span> kB
DirectMap2M:    <span class="token number">17135616</span> kB
DirectMap1G:    <span class="token number">15728640</span> kB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><blockquote><p>掌握上述基本知识后，尝试分析解决最初的内存问题，基本思路是先尝试复现，在复现的基础上收集内存指标，通过观察、对比和实验确定问题点，然后进行修复，最后观察修复效果并复盘</p></blockquote> <h2 id="问题复现"><a href="#问题复现" class="header-anchor">#</a> 问题复现</h2> <ol><li>问题发生在生产环境，尝试在测试环境寻找有相同问题的应用，
<ol><li>范围：最近7天内，应用重启次数大于1。</li> <li>结果没有找到</li></ol></li> <li>考虑到题跟Java容器的内存相关，怀疑是否跟JVM有关，尝试写代码mock堆内存压力升高的场景，看看是否可以复现</li></ol> <h3 id="模拟堆内存压力"><a href="#模拟堆内存压力" class="header-anchor">#</a> 模拟堆内存压力</h3> <p>思路： 通过代码来占用较大量的堆内存，观察working_set在此前后的变化，判断问题是否产生在堆上。</p> <blockquote><p>首先观察容器初始的状态</p></blockquote> <h4 id="初始状态"><a href="#初始状态" class="header-anchor">#</a> 初始状态</h4> <ul><li>从指标监测看到，物理内存使用量是0.46G左右，WorkingSet使用量为0.88G，有0.88-0.46=0.42G的GAP</li> <li>命令行查看内存占用明细</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">cat</span> /sys/fs/cgroup/memory/memory.usage_in_bytes 
<span class="token number">966750208</span> ≈ <span class="token number">0</span>.9G
$ <span class="token function">cat</span> /sys/fs/cgroup/memory/memory.stat
cache <span class="token number">461389824</span> ≈ <span class="token number">0</span>.44G
rss <span class="token number">512860160</span> ≈ <span class="token number">0</span>.48G
<span class="token punctuation">..</span>.
mapped_file <span class="token number">350171136</span> ≈ <span class="token number">0</span>.33G
<span class="token punctuation">..</span>.
inactive_anon <span class="token number">341835776</span>
active_anon <span class="token number">546357248</span>
inactive_file <span class="token number">294912</span>
active_file <span class="token number">85704704</span> ≈ <span class="token number">0</span>.081G
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>可以看到堆内存（RSS物理内存）占用0.48G，PageCache约为0.08G，匿名内存页约为0.33G，乍看上去一切正常</p> <h4 id="提升堆占用后的状态"><a href="#提升堆占用后的状态" class="header-anchor">#</a> 提升堆占用后的状态</h4> <p>相关代码如下，每次调用会占用x MB大小的堆内存，且线程睡眠一定时间内不会释放或者GC</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/increase-memory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">JsonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">increaseMemory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> x<span class="token punctuation">]</span><span class="token punctuation">;</span>
    bytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">JsonResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>调用参数：x = 300，s=1000000，连续调用3次后，理论上会在对上分配300*3=900M内存，1000秒后释放。</p> <p>GC前内存占用：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">cat</span> /sys/fs/cgroup/memory/memory.stat
cache <span class="token number">1406787584</span>  ≈ <span class="token number">1</span>.31G
rss <span class="token number">495648768</span> ≈ <span class="token number">0</span>.46G 
rss_huge <span class="token number">0</span>
mapped_file <span class="token number">1304526848</span> ≈ <span class="token number">1</span>.21G
<span class="token punctuation">..</span>.
inactive_file <span class="token number">10440704</span>
active_file <span class="token number">85626880</span>
<span class="token punctuation">..</span>.

$ <span class="token builtin class-name">unset</span> JAVA_TOOL_OPTIONS<span class="token punctuation">;</span>jhsdb jmap <span class="token parameter variable">--heap</span> <span class="token parameter variable">--pid</span> <span class="token number">1</span>
Attaching to process ID <span class="token number">1</span>, please wait<span class="token punctuation">..</span>.
Debugger attached successfully.
Server compiler detected.
JVM version is <span class="token number">17.0</span>.10+11-LTS-240

using thread-local object allocation.
ZGC with <span class="token number">2</span> thread<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

Heap Configuration:
   MinHeapFreeRatio         <span class="token operator">=</span> <span class="token number">40</span>
   MaxHeapFreeRatio         <span class="token operator">=</span> <span class="token number">70</span>
   MaxHeapSize              <span class="token operator">=</span> <span class="token number">1933574144</span> <span class="token punctuation">(</span><span class="token number">1844</span>.0MB<span class="token punctuation">)</span>
   NewSize                  <span class="token operator">=</span> <span class="token number">1363144</span> <span class="token punctuation">(</span><span class="token number">1</span>.2999954223632812MB<span class="token punctuation">)</span>
   MaxNewSize               <span class="token operator">=</span> <span class="token number">17592186044415</span> MB
   OldSize                  <span class="token operator">=</span> <span class="token number">5452592</span> <span class="token punctuation">(</span><span class="token number">5</span>.1999969482421875MB<span class="token punctuation">)</span>
   NewRatio                 <span class="token operator">=</span> <span class="token number">2</span>
   SurvivorRatio            <span class="token operator">=</span> <span class="token number">8</span>
   MetaspaceSize            <span class="token operator">=</span> <span class="token number">22020096</span> <span class="token punctuation">(</span><span class="token number">21</span>.0MB<span class="token punctuation">)</span>
   CompressedClassSpaceSize <span class="token operator">=</span> <span class="token number">218103808</span> <span class="token punctuation">(</span><span class="token number">208</span>.0MB<span class="token punctuation">)</span>
   MaxMetaspaceSize         <span class="token operator">=</span> <span class="token number">268435456</span> <span class="token punctuation">(</span><span class="token number">256</span>.0MB<span class="token punctuation">)</span>
   G1HeapRegionSize         <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>.0MB<span class="token punctuation">)</span>

Heap Usage:
 ZHeap          used 1140M, capacity 1250M, max capacity 1844M
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>GC后</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">cat</span> /sys/fs/cgroup/memory/memory.stat
cache <span class="token number">1617858560</span> ≈ <span class="token number">1</span>.5G
rss <span class="token number">525516800</span> ≈ <span class="token number">0</span>.48G
<span class="token punctuation">..</span>.
mapped_file <span class="token number">1476038656</span> ≈ <span class="token number">1</span>.37G
<span class="token punctuation">..</span>.
inactive_file <span class="token number">10690560</span>
active_file <span class="token number">107704320</span> ≈ <span class="token number">0</span>.1G

$ <span class="token builtin class-name">unset</span> JAVA_TOOL_OPTIONS<span class="token punctuation">;</span>jhsdb jmap <span class="token parameter variable">--heap</span> <span class="token parameter variable">--pid</span> <span class="token number">1</span>
Attaching to process ID <span class="token number">1</span>, please wait<span class="token punctuation">..</span>.
Debugger attached successfully.
Server compiler detected.
JVM version is <span class="token number">17.0</span>.10+11-LTS-240

using thread-local object allocation.
ZGC with <span class="token number">2</span> thread<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

Heap Configuration:
   MinHeapFreeRatio         <span class="token operator">=</span> <span class="token number">40</span>
   MaxHeapFreeRatio         <span class="token operator">=</span> <span class="token number">70</span>
   MaxHeapSize              <span class="token operator">=</span> <span class="token number">1933574144</span> <span class="token punctuation">(</span><span class="token number">1844</span>.0MB<span class="token punctuation">)</span>
   NewSize                  <span class="token operator">=</span> <span class="token number">1363144</span> <span class="token punctuation">(</span><span class="token number">1</span>.2999954223632812MB<span class="token punctuation">)</span>
   MaxNewSize               <span class="token operator">=</span> <span class="token number">17592186044415</span> MB
   OldSize                  <span class="token operator">=</span> <span class="token number">5452592</span> <span class="token punctuation">(</span><span class="token number">5</span>.1999969482421875MB<span class="token punctuation">)</span>
   NewRatio                 <span class="token operator">=</span> <span class="token number">2</span>
   SurvivorRatio            <span class="token operator">=</span> <span class="token number">8</span>
   MetaspaceSize            <span class="token operator">=</span> <span class="token number">22020096</span> <span class="token punctuation">(</span><span class="token number">21</span>.0MB<span class="token punctuation">)</span>
   CompressedClassSpaceSize <span class="token operator">=</span> <span class="token number">218103808</span> <span class="token punctuation">(</span><span class="token number">208</span>.0MB<span class="token punctuation">)</span>
   MaxMetaspaceSize         <span class="token operator">=</span> <span class="token number">268435456</span> <span class="token punctuation">(</span><span class="token number">256</span>.0MB<span class="token punctuation">)</span>
   G1HeapRegionSize         <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>.0MB<span class="token punctuation">)</span>

Heap Usage:
 ZHeap          used 286M, capacity 1430M, max capacity 1844M
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>可以看到，相比较初始状态，rss并没有明显变化，反而cache和mapped_file增加了约900M，引入了新问题：ZGC的堆分配对应cgroup的cache(mapped_file)部分，与以往JDK8不一致（JDK8堆分配在RSS），结合前面的内存分布知识，mapped_file属于cache的一部分，难道ZGC的堆不在匿名内存里？</p> <h3 id="zgc堆内存分配区域研究"><a href="#zgc堆内存分配区域研究" class="header-anchor">#</a> ZGC堆内存分配区域研究</h3> <p>在查询资料解决上述问题的同时，我们也观察了同样的场景在G1下的表现，与预期一致，堆占用提升，并不会导致cache部分的提升，且RSS部分的数量约等于配置的堆上限，可见G1收集器堆内存对应RSS部分。</p> <p>进一步的查阅资料后发现，ZGC的堆内存，底层使用<code>memfd_create</code>方法，具体如下</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> ZPhysicalMemoryBacking<span class="token operator">::</span><span class="token function">create_mem_fd</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// Create file</span>
  <span class="token keyword">const</span> <span class="token keyword">int</span> extra_flags <span class="token operator">=</span> ZLargePages<span class="token operator">::</span><span class="token function">is_explicit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>MFD_HUGETLB <span class="token operator">|</span> MFD_HUGE_2MB<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token keyword">int</span> fd <span class="token operator">=</span> ZSyscall<span class="token operator">::</span><span class="token function">memfd_create</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> MFD_CLOEXEC <span class="token operator">|</span> extra_flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token function">log_info_p</span><span class="token punctuation">(</span>gc<span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;Heap Backing File: /memfd:%s&quot;</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> fd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>查阅Linux的man page看，<code>memfd_create</code>方法创建一个匿名文件fd，再使用mmap方法来二次加载到虚拟内存中，所以这部分内存属于mmap内存。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>MEMFD_CREATE<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                                                    Linux Programmer's Manual                                                    MEMFD_CREATE<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

NAME
       memfd_create - create an anonymous <span class="token function">file</span>

SYNOPSIS
       <span class="token comment">#define _GNU_SOURCE         /* See feature_test_macros(7) */</span>
       <span class="token comment">#include &lt;sys/mman.h&gt;</span>

       int memfd_create<span class="token punctuation">(</span>const char *name, unsigned int flags<span class="token punctuation">)</span><span class="token punctuation">;</span>

DESCRIPTION
       memfd_create<span class="token punctuation">(</span><span class="token punctuation">)</span> creates an anonymous <span class="token function">file</span> and returns a <span class="token function">file</span> descriptor that refers to it.  The <span class="token function">file</span> behaves like a regular file, and so can be modified,
       truncated, memory-mapped, and so on.  However, unlike a regular file, it lives <span class="token keyword">in</span> RAM and has a volatile backing storage.  Once all  references  to  the
       <span class="token function">file</span> are dropped, it is automatically released.  Anonymous memory is used <span class="token keyword">for</span> all backing pages of the file.  Therefore, files created by memfd_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
       have the same semantics as other anonymous memory allocations such as those allocated using mmap<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> with the MAP_ANONYMOUS flag
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>通过进程的<code>smaps</code>命令来验证上述内存</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">cat</span> /proc/1/maps <span class="token operator">|</span><span class="token function">grep</span> heap
<span class="token number">40000000000</span>-40000600000 rw-s <span class="token number">16200000</span> 00:04 <span class="token number">4098814597</span>                   /memfd:java_heap <span class="token punctuation">(</span>deleted<span class="token punctuation">)</span>
<span class="token number">40000600000</span>-40001800000 rw-s 16a00000 00:04 <span class="token number">4098814597</span>                   /memfd:java_heap <span class="token punctuation">(</span>deleted<span class="token punctuation">)</span>
<span class="token number">40001800000</span>-40001a00000 rw-s 17e00000 00:04 <span class="token number">4098814597</span>                   /memfd:java_heap <span class="token punctuation">(</span>deleted<span class="token punctuation">)</span>
40001a00000-40001e00000 rw-s <span class="token number">18200000</span> 00:04 <span class="token number">4098814597</span>                   /memfd:java_heap <span class="token punctuation">(</span>deleted<span class="token punctuation">)</span>
<span class="token number">40002600000</span>-40002a00000 rw-s 02600000 00:04 <span class="token number">4098814597</span>                   /memfd:java_heap <span class="token punctuation">(</span>deleted<span class="token punctuation">)</span>
40002e00000-40003000000 rw-s 02e00000 00:04 <span class="token number">4098814597</span>                   /memfd:java_heap <span class="token punctuation">(</span>deleted<span class="token punctuation">)</span>
<span class="token number">40004800000</span>-40004a00000 rw-s 04800000 00:04 <span class="token number">4098814597</span>                   /memfd:java_heap <span class="token punctuation">(</span>deleted<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>至此，ZGC的堆内存分配区域理解完成，但是，即使所有的PageCache+RSS，也就2.5G左右，离问题触发时4G的阈值相去甚远，剩余的working_set内存都在哪里？要解决这个问题，还是希望能有一个相对稳定的复现流程。</p> <p>考虑到问题服务在JDK8上没有问题，那问题是否跟GC过程有关？下一步模拟下大量GC的过程，看看是否可以复现。</p> <h3 id="尝试大量触发gc"><a href="#尝试大量触发gc" class="header-anchor">#</a> 尝试大量触发GC</h3> <p>思路：在堆内存占用已经很大的前提下，尝试申请内存、使用内存、释放的循环。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/trigger-fullgc&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">JsonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">triggerFullGC</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;m&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> s<span class="token punctuation">,</span>
                                          <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> times<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> times<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 循环创建内存，使用，释放</span>
        <span class="token function">triggerFullGC</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">JsonResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">triggerFullGC</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">long</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> m<span class="token punctuation">]</span><span class="token punctuation">;</span>
    bytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/increase-memory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">JsonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">increaseMemory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;m&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 一次性占用大量内存</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> m<span class="token punctuation">]</span><span class="token punctuation">;</span>
    bytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">JsonResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>最终没有复现线上的问题，堆上的内存分配-释放循环，不会导致PageCache进一步提升，说明<strong>堆内存不是导致内存超限的原因</strong>。</p> <p>复现的过程陷入僵局，睡了一觉以后，考虑思路做一个转换，考虑寻找接近复现的服务</p> <h2 id="寻找问题相近的服务"><a href="#寻找问题相近的服务" class="header-anchor">#</a> 寻找问题相近的服务</h2> <p>测试环境尝试寻找接近超限的容器，查询条件为working_set&gt;3G且容器内存=4G，找到多个服务，选择典型且个人熟悉的服务观察。</p> <p>查看当前cgroup内存状态如下，可以看到active_file为1.13G左右，偏高</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">cat</span> /sys/fs/cgroup/memory/memory.stat
cache <span class="token number">2944737280</span> <span class="token operator">=</span> <span class="token number">2</span>.74G
rss <span class="token number">1069068288</span> <span class="token operator">=</span> <span class="token number">0</span>.99G
rss_huge <span class="token number">448790528</span>
mapped_file <span class="token number">1361448960</span> <span class="token operator">=</span>  <span class="token number">1</span>.26G
swap <span class="token number">0</span>
pgpgin <span class="token number">33070432</span>
pgpgout <span class="token number">32208029</span>
pgfault <span class="token number">52502832</span>
pgmajfault <span class="token number">1</span>
inactive_anon <span class="token number">1421869056</span>
active_anon <span class="token number">1083723776</span>
inactive_file <span class="token number">295665664</span> ≈ <span class="token number">0</span>.27G
active_file <span class="token number">1212522496</span> <span class="token operator">=</span> <span class="token number">1</span>.13G
unevictable <span class="token number">0</span>
hierarchical_memory_limit <span class="token number">4294967296</span>
hierarchical_memsw_limit <span class="token number">4294967296</span>
total_cache <span class="token number">2944737280</span>
total_rss <span class="token number">1069068288</span>
total_rss_huge <span class="token number">448790528</span>
total_mapped_file <span class="token number">1361448960</span>
total_swap <span class="token number">0</span>
total_pgpgin <span class="token number">0</span>
total_pgpgout <span class="token number">0</span>
total_pgfault <span class="token number">0</span>
total_pgmajfault <span class="token number">0</span>
total_inactive_anon <span class="token number">1421869056</span>
total_active_anon <span class="token number">1083723776</span>
total_inactive_file <span class="token number">295665664</span>
total_active_file <span class="token number">1212522496</span>
total_unevictable <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>从理论上分析，active_file对应的文件的page_cache，大部分为jar包，lib.so，以及少量IO对应的socket，前者启动时就加载，在前面分析过程中冷启动可以看出，大概在500M左右，远小于1.13G，这里有问题，需要进一步分析细节。</p> <h2 id="问题服务pagecache分析"><a href="#问题服务pagecache分析" class="header-anchor">#</a> 问题服务PageCache分析</h2> <p>掏出各路AI来分析了一下，AI推荐PageCache从下列文件中获得</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> /proc/1/smaps
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用AI快速编写了一个排序脚本，发现smaps排在前面的是堆内存块，且rss总数只有500M，不对，需要重新寻找。
再次通过AI搜索，找到一个可以查询page_cache的库：<a href="https://github.com/rfyiamcool/pgcacher" target="_blank" rel="noopener noreferrer">pgcacher<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/rfyiamcool/pgcacher
<span class="token function">make</span> <span class="token function">install</span>

<span class="token function">chmod</span> a+x pgcacher
./pgcacher <span class="token parameter variable">-pid</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上述运行以后的结果如文件:<a href="/views/issue/k8s_oom_killer/pgcacher.html">output</a></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ ./pgcacher <span class="token parameter variable">-pid</span> <span class="token number">1</span>
+----------------------------------------------------------------------------------------+----------------+-------------+----------------+-------------+---------+
<span class="token operator">|</span> Name                                                                                   <span class="token operator">|</span> Size           │ Pages       │ Cached Size    │ Cached Pages│ Percent │
<span class="token operator">|</span>----------------------------------------------------------------------------------------+----------------+-------------+----------------+-------------+---------<span class="token operator">|</span>
<span class="token operator">|</span> /logs/skywalking.log                                               <span class="token operator">|</span> <span class="token number">270</span>.131M       <span class="token operator">|</span> <span class="token number">69154</span>       <span class="token operator">|</span> <span class="token number">270</span>.131M       <span class="token operator">|</span> <span class="token number">69154</span>       <span class="token operator">|</span> <span class="token number">100.000</span> <span class="token operator">|</span>
<span class="token operator">|</span> /usr/lib/jvm/jdk-17-oracle-x64/lib/modules                                             <span class="token operator">|</span> <span class="token number">121</span>.238M       <span class="token operator">|</span> <span class="token number">31037</span>       <span class="token operator">|</span> <span class="token number">121</span>.238M       <span class="token operator">|</span> <span class="token number">31037</span>       <span class="token operator">|</span> <span class="token number">100.000</span> <span class="token operator">|</span>
<span class="token operator">|</span> /data/logs/serviceA/access.log                                                         <span class="token operator">|</span> <span class="token number">104</span>.286M       <span class="token operator">|</span> <span class="token number">26698</span>       <span class="token operator">|</span> <span class="token number">104</span>.286M       <span class="token operator">|</span> <span class="token number">26698</span>       <span class="token operator">|</span> <span class="token number">100.000</span> <span class="token operator">|</span>
<span class="token operator">|</span> /data/logs/gc2025-05-22_16-02-46.log                                                   <span class="token operator">|</span> <span class="token number">91</span>.887M        <span class="token operator">|</span> <span class="token number">23524</span>       <span class="token operator">|</span> <span class="token number">91</span>.231M        <span class="token operator">|</span> <span class="token number">23356</span>       <span class="token operator">|</span> <span class="token number">99.286</span>  <span class="token operator">|</span>
<span class="token operator">|</span> /data/logs/serviceA/warn.log                                                           <span class="token operator">|</span> <span class="token number">89</span>.316M        <span class="token operator">|</span> <span class="token number">22866</span>       <span class="token operator">|</span> <span class="token number">89</span>.316M        <span class="token operator">|</span> <span class="token number">22866</span>       <span class="token operator">|</span> <span class="token number">100.000</span> <span class="token operator">|</span>
<span class="token operator">|</span> /opt/serviceA.jar                                                                      <span class="token operator">|</span> <span class="token number">188</span>.411M       <span class="token operator">|</span> <span class="token number">48234</span>       <span class="token operator">|</span> <span class="token number">78</span>.932M        <span class="token operator">|</span> <span class="token number">20207</span>       <span class="token operator">|</span> <span class="token number">41.894</span>  <span class="token operator">|</span>
<span class="token operator">|</span> /data/logs/serviceA/error.log                                                          <span class="token operator">|</span> <span class="token number">61</span>.573M        <span class="token operator">|</span> <span class="token number">15763</span>       <span class="token operator">|</span> <span class="token number">61</span>.573M        <span class="token operator">|</span> <span class="token number">15763</span>       <span class="token operator">|</span> <span class="token number">100.000</span> <span class="token operator">|</span>
<span class="token operator">|</span> /data/logs/serviceA/info.log                                                           <span class="token operator">|</span> <span class="token number">32</span>.952M        <span class="token operator">|</span> <span class="token number">8436</span>        <span class="token operator">|</span> <span class="token number">32</span>.952M        <span class="token operator">|</span> <span class="token number">8436</span>        <span class="token operator">|</span> <span class="token number">100.000</span> <span class="token operator">|</span>
<span class="token operator">|</span> /usr/lib/jvm/jdk-17-oracle-x64/lib/server/libjvm.so                                    <span class="token operator">|</span> <span class="token number">21</span>.869M        <span class="token operator">|</span> <span class="token number">5599</span>        <span class="token operator">|</span> <span class="token number">21</span>.869M        <span class="token operator">|</span> <span class="token number">5599</span>        <span class="token operator">|</span> <span class="token number">100.000</span> <span class="token operator">|</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">|</span>----------------------------------------------------------------------------------------+----------------+-------------+----------------+-------------+---------<span class="token operator">|</span>
│ Sum                                                                                    │ <span class="token number">1</span>.025G         │ <span class="token number">268758</span>      │ <span class="token number">939</span>.132M       │ <span class="token number">240488</span>      │ <span class="token number">89.481</span>  │
+----------------------------------------------------------------------------------------+----------------+-------------+----------------+-------------+---------+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>pageCache总计有1G左右，与上面的统计对应，能看到最大的是skywalking.log文件，文件270M，占用的cache也约为这个值，需要优化。
顺手打开文件看看内容，可以看到有大量的报错，需要解决。同时，应用的info、warn等日志也比较大，有优化空间。</p> <h2 id="根因分析"><a href="#根因分析" class="header-anchor">#</a> 根因分析</h2> <p>应用打开的文件有一些大文件，打开文件对应需要使用PageCache，占用内存</p> <ol><li>skywaking-log 最大300M</li> <li>access-log 最大512M</li> <li>业务日志，4个级别，配置单文件最大为128M</li></ol> <p>仅上述这部分PageCahce加和极限情况下能达到（128M*4+300M+512M）=1.3G，加上目前启动固定内存占用有</p> <ol><li>2G：堆</li> <li>0.786G：元空间+CodeCache</li> <li>0.4G：依赖包固定的PageCache(so库，jar包, GC Log）
加起来=4.4G，考虑到还有网络I/O等的内存占用，所以很多情况下会导致OOM</li></ol> <h2 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h2> <ol><li>解决探针日志skywalking-api.log中对应的异常</li> <li>skywalking-api.log文件过大，需要缩小或进行chunk</li> <li>日志：access.log 过大，需要进行chunk</li> <li>应用日志：warn.log，info.log等，单文件过大，需要调整：<code>&lt;maxFileSize&gt;128MB&lt;/maxFileSize&gt;</code>修改应用配置</li></ol> <h2 id="效果"><a href="#效果" class="header-anchor">#</a> 效果</h2> <p>测试环境验证：上述解决方案上线后，应用的working_set平均降低30%</p> <h2 id="复盘"><a href="#复盘" class="header-anchor">#</a> 复盘</h2> <p>事后看，在最初尝试复现问题时，走了一些弯路，最后也没有成功复盘，最终是通过寻找<strong>问题相近服务</strong>破局，后续可以更灵活的调整问题切入的视角和思路。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://help.aliyun.com/zh/arms/application-monitoring/developer-reference/memory-metrics" target="_blank" rel="noopener noreferrer">常用的内存查询命令/指标的含义是什么_应用实时监控服务(ARMS)-阿里云帮助中心<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/36a1df62cda7" target="_blank" rel="noopener noreferrer">容器内存监控，是看rss还是wss?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://qingwave.github.io/container-memory/" target="_blank" rel="noopener noreferrer">容器内存分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://dbaplus.cn/news-134-6386-1.html" target="_blank" rel="noopener noreferrer">大受震撼！K8s里我的容器到底用了多少内存？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.aliyun.com/article/726120" target="_blank" rel="noopener noreferrer">带你读《新一代垃圾回收器ZGC设计与实现》之二：ZGC内存管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/601691903" target="_blank" rel="noopener noreferrer">Linux内存映射<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/a860MHz/article/details/99435257" target="_blank" rel="noopener noreferrer">OpenJDK ZGC 源码分析（三）内存管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7016936265161375752" target="_blank" rel="noopener noreferrer">技术翻译」JVM研究系列「绝版敲门砖」带你进入JVM-ZGC垃圾回收器的时代和未来<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/openjdk/jdk/blob/master/src/hotspot/os/linux/gc/z/zPhysicalMemoryBacking_linux.cpp#L202" target="_blank" rel="noopener noreferrer">ZGC内存分配源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://zhuanlan.zhihu.com/p/645904515" target="_blank" rel="noopener noreferrer">参考资料<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/19/2025, 8:33:55 AM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#问题现象" class="sidebar-link reco-side-问题现象" data-v-b57cc07c>问题现象</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#初步定位" class="sidebar-link reco-side-初步定位" data-v-b57cc07c>初步定位</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#内存统计知识" class="sidebar-link reco-side-内存统计知识" data-v-b57cc07c>内存统计知识</a></li><li class="level-3" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#linux系统内存分布" class="sidebar-link reco-side-linux系统内存分布" data-v-b57cc07c>Linux系统内存分布</a></li><li class="level-4" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#关于buffers-cache" class="sidebar-link reco-side-关于buffers-cache" data-v-b57cc07c>关于buffers/cache</a></li><li class="level-3" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#进程内存构成" class="sidebar-link reco-side-进程内存构成" data-v-b57cc07c>进程内存构成</a></li><li class="level-3" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#常见内存统计工具" class="sidebar-link reco-side-常见内存统计工具" data-v-b57cc07c>常见内存统计工具</a></li><li class="level-4" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#cgroup内存统计" class="sidebar-link reco-side-cgroup内存统计" data-v-b57cc07c>cgroup内存统计</a></li><li class="level-4" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#proc-pid-status" class="sidebar-link reco-side-proc-pid-status" data-v-b57cc07c>/proc/{pid}/status</a></li><li class="level-4" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#proc-meminfo" class="sidebar-link reco-side-proc-meminfo" data-v-b57cc07c>/proc/meminfo</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#问题复现" class="sidebar-link reco-side-问题复现" data-v-b57cc07c>问题复现</a></li><li class="level-3" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#模拟堆内存压力" class="sidebar-link reco-side-模拟堆内存压力" data-v-b57cc07c>模拟堆内存压力</a></li><li class="level-4" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#初始状态" class="sidebar-link reco-side-初始状态" data-v-b57cc07c>初始状态</a></li><li class="level-4" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#提升堆占用后的状态" class="sidebar-link reco-side-提升堆占用后的状态" data-v-b57cc07c>提升堆占用后的状态</a></li><li class="level-3" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#zgc堆内存分配区域研究" class="sidebar-link reco-side-zgc堆内存分配区域研究" data-v-b57cc07c>ZGC堆内存分配区域研究</a></li><li class="level-3" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#尝试大量触发gc" class="sidebar-link reco-side-尝试大量触发gc" data-v-b57cc07c>尝试大量触发GC</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#寻找问题相近的服务" class="sidebar-link reco-side-寻找问题相近的服务" data-v-b57cc07c>寻找问题相近的服务</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#问题服务pagecache分析" class="sidebar-link reco-side-问题服务pagecache分析" data-v-b57cc07c>问题服务PageCache分析</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#根因分析" class="sidebar-link reco-side-根因分析" data-v-b57cc07c>根因分析</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#解决方案" class="sidebar-link reco-side-解决方案" data-v-b57cc07c>解决方案</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#效果" class="sidebar-link reco-side-效果" data-v-b57cc07c>效果</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#复盘" class="sidebar-link reco-side-复盘" data-v-b57cc07c>复盘</a></li><li class="level-2" data-v-b57cc07c><a href="/views/issue/k8s_oom_killer/k8s_oom_killer.html#参考资料" class="sidebar-link reco-side-参考资料" data-v-b57cc07c>参考资料</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/app.fd5d37e3.js" defer></script><script src="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/4.9ffcf601.js" defer></script><script src="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/1.0a35a5ae.js" defer></script><script src="https://cdn.jsdmirror.com/gh/kkyeer/kkyeer.github.io@gh-pages/assets/js/36.305c8fcc.js" defer></script>
  </body>
</html>
