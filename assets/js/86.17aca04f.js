(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{523:function(a,s,t){"use strict";t.r(s);var e=t(2),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"配置免费https-let-s-encrypt-centos7-nginx-tomcat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置免费https-let-s-encrypt-centos7-nginx-tomcat"}},[a._v("#")]),a._v(" 配置免费HTTPS : let's encrypt+centos7+nginx+tomcat")]),a._v(" "),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[a._v("#")]),a._v(" 前言")]),a._v(" "),s("p",[a._v("突然想给自己的基础版阿里云服务器增加https支持，折腾了许久，简单记一下")]),a._v(" "),s("h2",{attrs:{id:"获取证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取证书"}},[a._v("#")]),a._v(" 获取证书")]),a._v(" "),s("p",[a._v("1）获取certbot-auto脚本")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://dl.eff.org/certbot-auto\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("2）使certbot-auto脚本可执行")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" a+x ./certbot-auto\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("3）运行certbot-auto，安装Certbot")]),a._v(" "),s("blockquote",[s("ol",[s("li",[a._v("./certbot-auto certonly")]),a._v(" "),s("li",[a._v("选择2")])])]),a._v(" "),s("p",[a._v("运行完毕后，获得的私钥等在文件夹/etc/letsencrypt/live/{websiteDomain}/下，websiteDomain为申请时输入的网站名")]),a._v(" "),s("h2",{attrs:{id:"刷新证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#刷新证书"}},[a._v("#")]),a._v(" 刷新证书")]),a._v(" "),s("p",[a._v("1）Let's Encrypt的证书只有3个月期限，到期刷新")]),a._v(" "),s("div",{staticClass:"language-Shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("./certbot-auto renew\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"附1-nginx-配置ssl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#附1-nginx-配置ssl"}},[a._v("#")]),a._v(" 附1：nginx 配置ssl")]),a._v(" "),s("p",[a._v("nginx本身作为静态资源服务器，配置https需要编辑nginx/conf/nginx.conf文件，示例配置如下，将下述代码中的{websiteDomain}替换成自己的域名，比如域名是www.abc.com,则 ssl_certificate      /etc/letsencrypt/live/www.abc.com/fullchain.pem;")]),a._v(" "),s("div",{staticClass:"language-text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("    server{\n    listen 80;\n    server_name localhost;\n    #http请求转发443端口\n    rewrite ^(.*)$  https://$host$1 permanent;\n    }\n    server {\n    #增加https设置\n        listen       443 ssl;\n        server_name  localhost;\n\n        ssl_certificate      /etc/letsencrypt/live/{websiteDomain}/fullchain.pem;\n        ssl_certificate_key  /etc/letsencrypt/live/{websiteDomain}/privkey.pem;\n        ssl_session_timeout  5m;\n\n        location / {\n            root   /webroot;\n        index index.html;\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    #........省略其他设置\n    }\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br")])]),s("h2",{attrs:{id:"附2-tomcat配置https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#附2-tomcat配置https"}},[a._v("#")]),a._v(" 附2：Tomcat配置https")]),a._v(" "),s("h3",{attrs:{id:"第一步-tomcat安装apr"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一步-tomcat安装apr"}},[a._v("#")]),a._v(" 第一步：Tomcat安装apr")]),a._v(" "),s("p",[a._v("因为下一步tomcat配置https需要需要编译apr\n"),s("strong",[a._v("注意，编译过程中需要jni相关头文件，在openjdk里没有找到，所以临时安装了OracleJDK，即下述--with-java-home参数指定的路径")])]),a._v(" "),s("ol",[s("li",[a._v("安装依赖\nyum install apr-devel apr apr-util")]),a._v(" "),s("li",[a._v("解压tomcat文件夹中自带的tomcat-native源码，不需下载，在bin目录下有\ntar -xvf tomcat/bin/tomcat-native.tar.gz")]),a._v(" "),s("li",[a._v("可选：下载并解压OracleJDK到当前文件夹，步骤略")]),a._v(" "),s("li",[a._v("编译\ncd tomcat-native-1.2.16-src/native/\n./configure --prefix=/usr/local/apr --with-java-home=./jdk1.8.0_181/\n./configure && make && make install")])]),a._v(" "),s("h3",{attrs:{id:"第二步-tomcat配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第二步-tomcat配置"}},[a._v("#")]),a._v(" 第二步：Tomcat配置")]),a._v(" "),s("ul",[s("li",[s("h4",{attrs:{id:"conf-web-xml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#conf-web-xml"}},[a._v("#")]),a._v(" conf/web.xml")])])]),a._v(" "),s("p",[a._v("增加如下配置")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("security-constraint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("web-resource-collection")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("web-resource-name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("SSL"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("web-resource-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("url-pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("/*"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("url-pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("web-resource-collection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("user-data-constraint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("transport-guarantee")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("CONFIDENTIAL"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("transport-guarantee")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("user-data-constraint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("security-constraint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("ul",[s("li",[s("h4",{attrs:{id:"conf-server-xml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#conf-server-xml"}},[a._v("#")]),a._v(" conf/server.xml")])])]),a._v(" "),s("p",[a._v('将相关接口配置为https服务，将下述代码中的{websiteDomain}替换成自己的域名，比如域名是www.abc.com,则certificateKeyFile="/etc/letsencrypt/live/www.abc.com/privkey.pem",其他位置类似')]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("Connector")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("port")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("12334"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("protocol")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("org.apache.coyote.http11.Http11AprProtocol"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v("\n               "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("maxThreads")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("150"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("SSLEnabled")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("UpgradeProtocol")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("className")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("org.apache.coyote.http2.Http2Protocol"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("/>")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("SSLHostConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("Certificate")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("certificateKeyFile")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("/etc/letsencrypt/live/{websiteDomain}/privkey.pem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v("\n                         "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("certificateFile")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("/etc/letsencrypt/live/{websiteDomain}/cert.pem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v("\n                         "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("certificateChainFile")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("/etc/letsencrypt/live/{websiteDomain}/chain.pem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v("\n                         "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("RSA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("/>")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("SSLHostConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("Connector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("h2",{attrs:{id:"附4-自签名openssl-证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#附4-自签名openssl-证书"}},[a._v("#")]),a._v(" 附4 自签名OpenSSL 证书")]),a._v(" "),s("h3",{attrs:{id:"方式1-简单-适合快速操作-但是浏览器无法信任"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式1-简单-适合快速操作-但是浏览器无法信任"}},[a._v("#")]),a._v(" 方式1：简单，适合快速操作，但是浏览器无法信任")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("openssl genrsa "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-des3")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" ca.key "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v("\nopenssl rsa "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" ca.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" ca.key.nopass\nopenssl req "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-key")]),a._v(" ca.key.nopass "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" server.csr\nopenssl x509 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-req")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-days")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("365")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" server.csr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-signkey")]),a._v(" ca.key.nopass "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" server.crt\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"方式2-全面-适合需要信任自签名证书的场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式2-全面-适合需要信任自签名证书的场景"}},[a._v("#")]),a._v(" 方式2：全面，适合需要信任自签名证书的场景")]),a._v(" "),s("p",[a._v("参考："),s("a",{attrs:{href:"https://icoolworld.github.io/chrome%E5%AF%BC%E5%85%A5CA%E6%A0%B9%E8%AF%81%E4%B9%A6%E5%90%8E-%E6%8F%90%E7%A4%BASubject-Alternative-Name-Missing%E9%97%AE%E9%A2%98.html#2%E5%88%9B%E5%BB%BA%E8%87%AA%E7%AD%BE%E5%90%8D%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AF%81%E4%B9%A6createselfsignedcertificatesh",target:"_blank",rel:"noopener noreferrer"}},[a._v("Chrome导入ca根证书后 提示subject Alternative Name Missing问题"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("新建 createCAkey.sh")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/usr/bin/env bash")]),a._v("\nopenssl genrsa "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-des3")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" rootCA.key "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v("\nopenssl req "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-x509")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-key")]),a._v(" rootCA.key.nopass "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" rootCA.cer "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-days")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("700")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-subj")]),a._v(" /CN"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"MY CA"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设备上安装此CA证书并信任即可")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("执行后 创建无密码CA.key")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("openssl rsa "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" rootCA.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" rootCA.key.nopass\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 输入上一步的密码")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("新建 createServerSelfSignedKey.sh")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/usr/bin/env bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" openssl genrsa "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" server.key "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" openssl req "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sha256")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-nodes")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" server.csr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-key")]),a._v(" server.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-config")]),a._v(" server.csr.cnf\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" openssl x509 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-req")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" server.csr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-CA")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/rootCA.cer "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-CAkey")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/rootCA.key.nopass "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-CAcreateserial")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-CAserial")]),a._v(" serial "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" server.cer "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-days")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("700")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sha256")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-extfile")]),a._v(" v3.ext\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("blockquote",[s("p",[a._v("v3.ext")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("authorityKeyIdentifier")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("keyid,issuer\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("basicConstraints")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("CA:FALSE\nkeyUsage "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nsubjectAltName "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" @alt_names\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("alt_names"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nDNS.1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" SOME_DOMAIN_TO_BE_REPLACED\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("blockquote",[s("p",[a._v("server.csr.cnf")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\ndefault_bits "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v("\nprompt "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" no\ndefault_md "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" sha256\ndistinguished_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" dn\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("dn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("C")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("US\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("New York\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("L")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Rochester\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("O")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("End Point\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("OU")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Testing Domain\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("emailAddress")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("EMAIL_TO_BE_REPLACED\nCN "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" SOME_DOMAIN_TO_BE_REPLACED\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("p",[a._v("注意: iOS安装完成CA证书后，安装成功并未授信证书, 需要到 设置 ---\x3e 通用 ---\x3e 关于本机 ---\x3e 证书信任设置 下对证书开启完全信任")])])}),[],!1,null,null,null);s.default=n.exports}}]);