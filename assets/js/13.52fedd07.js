(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{449:function(_,t,v){"use strict";v.r(t);var e=v(2),d=Object(e.a)({},(function(){var _=this,t=_._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"mysql性能优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql性能优化"}},[_._v("#")]),_._v(" MySQL性能优化")]),_._v(" "),t("h2",{attrs:{id:"简单情况-缺少索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简单情况-缺少索引"}},[_._v("#")]),_._v(" 简单情况，缺少索引")]),_._v(" "),t("p",[_._v("索引只有batch_id，查询实际上是\nselect * from w_table where batch_id = 1 and status = 2")]),_._v(" "),t("h2",{attrs:{id:"索引不能乱加-在错误的列上建立索引导致磁盘空间爆炸"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引不能乱加-在错误的列上建立索引导致磁盘空间爆炸"}},[_._v("#")]),_._v(" 索引不能乱加！！！在错误的列上建立索引导致磁盘空间爆炸")]),_._v(" "),t("p",[_._v("在timestamp字段建立索引，导致数据空间16G的情况下，索引空间占用达到60G！")]),_._v(" "),t("p",[t("strong",[_._v("原因？？？")])]),_._v(" "),t("h2",{attrs:{id:"索引下推"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引下推"}},[_._v("#")]),_._v(" 索引下推")]),_._v(" "),t("h2",{attrs:{id:"慢sql优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#慢sql优化"}},[_._v("#")]),_._v(" 慢SQL优化")]),_._v(" "),t("ol",[t("li",[_._v("索引下推变为顺序查询（MRR）")])]),_._v(" "),t("p",[_._v("优化前")]),_._v(" "),t("p",[t("code",[_._v("select c1,c2 from tableA where relation_id_1 in (1,2,3) and relation_id_2 in (400,500,600)")])]),_._v(" "),t("p",[_._v("此时索引下推，Explain表现")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("id")]),_._v(" "),t("th",[_._v("select_type")]),_._v(" "),t("th",[_._v("table")]),_._v(" "),t("th",[_._v("partitions")]),_._v(" "),t("th",[_._v("type")]),_._v(" "),t("th",[_._v("possible_keys")]),_._v(" "),t("th",[_._v("key")]),_._v(" "),t("th",[_._v("key_len")]),_._v(" "),t("th",[_._v("ref")]),_._v(" "),t("th",[_._v("rows")]),_._v(" "),t("th",[_._v("filtered")]),_._v(" "),t("th",[_._v("Extra")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("1")]),_._v(" "),t("td",[_._v("SIMPLE")]),_._v(" "),t("td",[_._v("tableA")]),_._v(" "),t("td",[_._v("NULL")]),_._v(" "),t("td",[_._v("range")]),_._v(" "),t("td",[_._v("idx_C2_C3,idx_C2_C1")]),_._v(" "),t("td",[_._v("idx_C2_C3")]),_._v(" "),t("td",[_._v("8")]),_._v(" "),t("td",[_._v("NULL")]),_._v(" "),t("td",[_._v("540780")]),_._v(" "),t("td",[_._v("5")]),_._v(" "),t("td",[_._v("Using index condition; Using where")])])])]),_._v(" "),t("p",[_._v("优化业务逻辑，"),t("code",[_._v("relation_id_1 in (1,2,3)")]),_._v("优化为多个"),t("code",[_._v("relation_id_1 = 1")]),_._v("（边缘定时任务，业务可接受），整个SQL优化为")]),_._v(" "),t("p",[t("code",[_._v("select c1,c2 from tableA where relation_id_1 = 1 and relation_id_2 in (400,500,600)")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("id")]),_._v(" "),t("th",[_._v("select_type")]),_._v(" "),t("th",[_._v("table")]),_._v(" "),t("th",[_._v("partitions")]),_._v(" "),t("th",[_._v("type")]),_._v(" "),t("th",[_._v("possible_keys")]),_._v(" "),t("th",[_._v("key")]),_._v(" "),t("th",[_._v("key_len")]),_._v(" "),t("th",[_._v("ref")]),_._v(" "),t("th",[_._v("rows")]),_._v(" "),t("th",[_._v("filtered")]),_._v(" "),t("th",[_._v("Extra")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("改造前")]),_._v(" "),t("td",[_._v("SIMPLE")]),_._v(" "),t("td",[_._v("tableA")]),_._v(" "),t("td",[_._v("NULL")]),_._v(" "),t("td",[_._v("range")]),_._v(" "),t("td",[_._v("idx_C2_C3,idx_C2_C1")]),_._v(" "),t("td",[_._v("idx_C2_C3")]),_._v(" "),t("td",[_._v("8")]),_._v(" "),t("td",[_._v("NULL")]),_._v(" "),t("td",[_._v("540780")]),_._v(" "),t("td",[_._v("5")]),_._v(" "),t("td",[_._v("Using index condition; Using where")])]),_._v(" "),t("tr",[t("td",[_._v("改造后")]),_._v(" "),t("td",[_._v("SIMPLE")]),_._v(" "),t("td",[_._v("tableA")]),_._v(" "),t("td",[_._v("NULL")]),_._v(" "),t("td",[_._v("range")]),_._v(" "),t("td",[_._v("idx_C2_C3,idx_C2_C1")]),_._v(" "),t("td",[_._v("idx_C2_C1")]),_._v(" "),t("td",[_._v("17")]),_._v(" "),t("td",[_._v("NULL")]),_._v(" "),t("td",[_._v("172")]),_._v(" "),t("td",[_._v("10")]),_._v(" "),t("td",[_._v("Using index condition; Using where; Using MRR")])])])]),_._v(" "),t("p",[_._v("注意，改造前后都使用了索引下推技术（Using index condition），但是改造后多了Using MRR")])])}),[],!1,null,null,null);t.default=d.exports}}]);