(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{540:function(e,t,s){"use strict";s.r(t);var a=s(2),n=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"将easyconnect放入docker容器运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将easyconnect放入docker容器运行"}},[e._v("#")]),e._v(" 将EasyConnect放入Docker容器运行")]),e._v(" "),t("p",[e._v("以"),t("a",{attrs:{href:"https://github.com/Hagb/docker-easyconnect",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/Hagb/docker-easyconnect"),t("OutboundLink")],1),e._v("仓库为基础，进行改造，首先将代码"),t("code",[e._v("git clone")]),e._v("到本地")]),e._v(" "),t("h2",{attrs:{id:"自定义编译镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义编译镜像"}},[e._v("#")]),e._v(" 自定义编译镜像")]),e._v(" "),t("blockquote",[t("p",[e._v("修改镜像源")])]),e._v(" "),t("p",[e._v("源代码使用阿里云的debian镜像，速度相对较慢，需要改造成清华镜像源")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("删除Dockerfile中"),t("code",[e._v("sed -i s/deb.debian.org/mirrors.aliyun.com/ /etc/apt/sources.list; fi")]),e._v("部分代码")])]),e._v(" "),t("li",[t("p",[e._v("代码根目录下新建sources.list文件，内容如下，注意此处使用"),t("code",[e._v("http")]),e._v("而不是s是为了省略apt update过程中的一些报错")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("deb http://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free\ndeb http://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("Dockerfile中新增一行"),t("code",[e._v("COPY sources.list /etc/apt/sources.list")])])])]),e._v(" "),t("blockquote",[t("p",[e._v("修改deb包")])]),e._v(" "),t("p",[e._v("对于EC安装包为特制版本的，不使用源码中提供的wget方法，改为复制到源码根目录后，复制到镜像文件中")]),e._v(" "),t("div",{staticClass:"language-docker line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COPY")]),e._v(" EasyConnect.deb /tmp/EasyConnect.deb")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" dpkg -i /tmp/EasyConnect.deb")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("blockquote",[t("p",[e._v("编译镜像，解决问题")])]),e._v(" "),t("p",[t("code",[e._v("docker image build -f Dockerfile -t docker-easyconnect .")])]),e._v(" "),t("p",[e._v("问题1 安装自己的deb包出现依赖问题时，在Dockerfile的apt-get install命令后新增对应的依赖即可，对于我的情况，需要新增两个依赖包 lsb-release systemd")]),e._v(" "),t("h2",{attrs:{id:"创建运行与配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建运行与配置"}},[e._v("#")]),e._v(" 创建运行与配置")]),e._v(" "),t("blockquote",[t("p",[e._v("运行容器")])]),e._v(" "),t("p",[t("code",[e._v("docker run -d --name docker-ec --device /dev/net/tun --cap-add NET_ADMIN -ti -e PASSWORD=VNC_PASS -v $HOME/.ecdata:/root -p 5901:5901 -p 1080:1080 -p 8888:8888 docker-easyconnect")])]),e._v(" "),t("p",[e._v("注意上面的环境变量"),t("code",[e._v("-e PASSWORD=VNC_PASS")]),e._v("后面是指定VNC连接的密码")]),e._v(" "),t("blockquote",[t("p",[e._v("配置")])]),e._v(" "),t("p",[e._v("使用VNC客户端连接容器，我使用的是"),t("strong",[e._v("Remmina")]),e._v("，端口5901，密码使用上面的密码")]),e._v(" "),t("p",[e._v("此时容器已经准备完成")]),e._v(" "),t("h2",{attrs:{id:"常用环境配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用环境配置"}},[e._v("#")]),e._v(" 常用环境配置")]),e._v(" "),t("p",[e._v("对于浏览器，使用Omega进行切换，协议socks5，端口1080")]),e._v(" "),t("p",[e._v("对于Java程序，在RUN配置中的VM options增加选项:"),t("code",[e._v("-DsocksProxyHost=127.0.0.1 -DsocksProxyPort=1080")]),e._v(" "),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/kkyeer/picbed/20220828113953.png",alt:"20220828113953"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);