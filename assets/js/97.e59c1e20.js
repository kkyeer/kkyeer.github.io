(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{534:function(n,t,p){"use strict";p.r(t);var _=p(2),s=Object(_.a)({},(function(){var n=this,t=n._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("p",[n._v("Nginx服务器的反向代理proxy_pass配置方法讲解")]),n._v(" "),t("p",[n._v("Nginx的配置还是比较简单的，如：\n1\n2\n3\n4")]),n._v(" "),t("p",[n._v("location ~ /*\n{\nproxy_pass http://127.0.0.1:8008;\n}")]),n._v(" "),t("p",[n._v("或者可以\n1\n2\n3\n4")]),n._v(" "),t("p",[n._v("location /\n{\nproxy_pass http://127.0.0.1:8008;\n}")]),n._v(" "),t("p",[n._v("Apache2的反向代理的配置是：\n1")]),n._v(" "),t("p",[n._v("ProxyPass /ysz/ http://localhost:8080/")]),n._v(" "),t("p",[n._v("然而，如果要配置一个相对复杂的反向代理\nNginx相对Apache2就要麻烦一些了\n比如，将url中以/wap/开头的请求转发到后台对应的某台server上\n可以再Nginx里设置一个变量，来临时保存/wap/后面的路径信息\n1\n2\n3\n4\n5\n6\n7\n8\n9")]),n._v(" "),t("p",[n._v("location ^~ /wap/\n{\nif ($request_uri ~ /wap/(\\d+)/(.+))\n{\nset $bucketid $1;\nset $params $2;\n}\nproxy_pass http://mx$bucketid.test.com:6601/$params;\n}")]),n._v(" "),t("p",[n._v("也可以首先rewrite一下，然后再代理：\n1\n2\n3\n4")]),n._v(" "),t("p",[n._v("location ^~ /wap/{\nrewrite /wap/(\\d+)/(.+) /$2?$args break;\nproxy_pass http://mx$1.test.com:6601;\n}")]),n._v(" "),t("p",[n._v("或者\n1\n2\n3\n4")]),n._v(" "),t("p",[n._v("location ~* /wap/(\\d+)/(.+)\n{\nproxy_pass http://mx$1.test.com:6601/$2?$args;\n}")]),n._v(" "),t("p",[n._v("注意上面最后的?$args，表明把原始url最后的get参数也给代理到后台\n如果在proxy_pass中使用了变量（不管是主机名变量$1或后面的$2变量），则必须得加这段代码\n但如果pass_proxy后没用任何变量，则不需要加，它默认会把所有的url都给代理到后台，如：\n1\n2\n3\n4")]),n._v(" "),t("p",[n._v("location ~* /wap/(\\d+)/(.+)\n{\nproxy_pass http://mx.test.com:6601;\n}")]),n._v(" "),t("p",[n._v("而Apache2相对就简单多了：\n1\n2\n3\n4\n5\n6")]),n._v(" "),t("p",[n._v("ProxyPassMatch ^/wap/(.*)$  http://192.168.132.147/$1")]),n._v(" "),t("p",[n._v("if ($host ~* www.(."),t("em",[n._v(")){\nset $host_without_www $1;\nrewrite (.")]),n._v(")$ http://$host_without_www/www$1;\n}")]),n._v(" "),t("p",[n._v("url的/问题\n在nginx中配置proxy_pass时，当在后面的url加上了/，相当于是绝对根路径，则nginx不会把location中匹配的路径部分代理走;如果没有/，则会把匹配的路径部分也给代理走。")]),n._v(" "),t("p",[n._v("下面四种情况分别用http://192.168.1.4/proxy/test.html 进行访问。\n第一种：\n1\n2\n3")]),n._v(" "),t("p",[n._v("location /proxy/ {\nproxy_pass http://127.0.0.1:81/;\n}")]),n._v(" "),t("p",[n._v("会被代理到http://127.0.0.1:81/test.html 这个url")]),n._v(" "),t("p",[n._v("第二咱(相对于第一种，最后少一个 /)\n1\n2\n3")]),n._v(" "),t("p",[n._v("location /proxy/ {\nproxy_pass http://127.0.0.1:81;\n}")]),n._v(" "),t("p",[n._v("会被代理到http://127.0.0.1:81/proxy/test.html 这个url")]),n._v(" "),t("p",[n._v("第三种：\n1\n2\n3")]),n._v(" "),t("p",[n._v("location /proxy/ {\nproxy_pass http://127.0.0.1:81/ftlynx/;\n}")]),n._v(" "),t("p",[n._v("会被代理到http://127.0.0.1:81/ftlynx/test.html 这个url。")]),n._v(" "),t("p",[n._v("第四种情况(相对于第三种，最后少一个 / )：\n1\n2\n3")]),n._v(" "),t("p",[n._v("location /proxy/ {\nproxy_pass http://127.0.0.1:81/ftlynx;\n}")]),n._v(" "),t("p",[n._v("会被代理到http://127.0.0.1:81/ftlynxtest.html 这个url")]),n._v(" "),t("p",[n._v("上面的结果都是本人结合日志文件测试过的。从结果可以看出，应该说分为两种情况才正确。即http://127.0.0.1:81 (上面的第二种) 这种和 http://127.0.0.1:81/.... （上面的第1，3，4种） 这种。")]),n._v(" "),t("p",[n._v("https://www.cnblogs.com/lianxuan1768/p/8383804.html")])])}),[],!1,null,null,null);t.default=s.exports}}]);