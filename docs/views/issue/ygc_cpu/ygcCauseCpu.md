---
date: 2022-11-27 21:56:37
categories:
  - 经验&教训
tags:
  - 
publish: false
---

# 某服务少部分节点CPU 100%，导致局部RT飙升

## 思路

1. 排查问题节点CPU 100%的表面原因

引起节点CPU打满的原因有很多，经排查线上监控各指标情况最终确认，**问题节点YGC次数和总时长大于正常节点**，其余指标（如FullGC，线程数等）无明显区别，因此重点分析导致YGC次数飙升的原因

> 如果从重点指标监控无法分析原因，可能需要使用火焰图等辅助工具来协助分析，此时需要根据具体的DevOps基建来具体分析

2. 排查线上流量与前期压测流量区别

因为成本和时间考量，本次压测流量采用的是手动构造方式，怀疑是否流量模型与线上有区别导致单节点出现问题

分析：流量模型分为3部分构成：请求参数，请求压力（QPS）,流量分布效果，分别进行分析

- 请求参数：经采样分析，这部分请求均匀分布，在较大的流量和负载均衡的作用下，近似认为问题节点与其他节点请求参数无明显差别
- 请求压力：通过线上监控分析可以判断，问题节点的请求压力与其他节点无明显区别
- 流量分布：考虑到手动构造流量与线上实际流量存在差距，且问题场景的并发流量较高，此场景采用的是5分钟1.2W QPS持续流量模型（除此之外还有正态分布，半正态分布等模型），与线上实际流量对比，实际流量为2WQPS持续，除限流量较压测多以外，差别不大，暂时排除

怀疑有其他原因如CPU资源竞争导致问题节点性能下降，因为压榨过于极限，导致单节点出现问题，此问题仅出现一次，一直无法复现，需要继续观察
